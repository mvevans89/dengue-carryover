range <- sub("-", "/", range)
#create a list to save everything into
all <- list()
#run a for loop for each month in the date range
for (y in 1:length(range)){
url <- paste("https://www.wunderground.com/history/airport/", code,"/",
range[y], "/1/MonthlyHistory.html?format=1", sep="")
all[[y]] <- read.csv(url)[,c(1,varChoice)]
#rename date so that daylight savings time doesn't mess it up
colnames(all[[y]]) <- c("Date", colnames(all[[y]])[-1])
}
#turn list of data into one long dataframe
all <- ldply(all)
#convert to metric if chosen
if (metric==T) {
all$Max.TempC <- (all$Max.TemperatureF - 32) * 5 / 9
all$Mean.TempC <- (all$Mean.TemperatureF - 32) * 5 / 9
all$Min.TempC <- (all$Min.TemperatureF - 32) * 5 / 9
#adjust precipitation becuase T is NA
#having trouble getting precipitation to work right now
#all$Precipmm <- as.numeric(as.numeric(all$PrecipitationIn) * 25.4)
}
return(all)
}
stationList <- list.files(path="country-raw/", pattern = ".csv", recursive=T)
#crop out the folder names
codes <- gsub(".*/", "", stationList)
codes <- substr(codes,1,4)
#create list of names to save as without the 2
saveNames <- gsub("2", "", stationList)
#create these directories so we can save in them
#sapply(paste("earlyYear/", unique(gsub("/.*", "", saveNames)), sep=""), dir.create)
newScrape <- function(codes, start, end){
for (c in 1:length(codes)){
all <- weatherScrape(codes[c], start=start, end=end)
fname <- paste("earlyYear/", saveNames[c], sep="")
write.csv(all, fname, row.names = F)
}
}
weatherScrape <- function(code, start, end, varChoice=c(2:4, 8:10, 20),
metric=F){
##Arguments
# code : Airport code
# start : "Year/Month" start ( "2016-2-01")
# end : "Year/Month" end ("2016-3-01")
# varChoice: choice of variable columns, default is Temp, RH, and rainfall
# metric: TRUE or FALSE for metric measurements, default is F
## Returns
# dataframe of downloaded weather data
#Columns are
# 1 : Date (ALWAYS CHOSEN, so don't select)
# 2 : Max.Temp (F)
# 3 : Mean. Temp (F)
# 4 : Min. Temp (F)
# 5 : Max. Dew Point (F)
# 6 : Mean Dew Point (F)
# 7 : Min Dew Point (F)
# 8 : Max Humidity
# 9 : Mean Humidity
# 10: Min Humidity
# there are a bunch between 10 and 20 that we don't care about
# 20: Precip (Inches)
require(plyr)
#create list of date range by month
range <- seq.Date(from = as.Date(start, format="%Y-%m-%d"), to = as.Date(end, format="%Y-%m-%d"),
by = "month")
#subset range to get months
range <- substr(range, 1, 7)
#replace "-" with "/"
range <- sub("-", "/", range)
#create a list to save everything into
all <- list()
#run a for loop for each month in the date range
for (y in 1:length(range)){
url <- paste("https://www.wunderground.com/history/airport/", code,"/",
range[y], "/1/MonthlyHistory.html?format=1", sep="")
all[[y]] <- read.csv(url)[,c(1,varChoice)]
#rename date so that daylight savings time doesn't mess it up
colnames(all[[y]]) <- c("Date", colnames(all[[y]])[-1])
}
#turn list of data into one long dataframe
all <- ldply(all)
#convert to metric if chosen
if (metric==T) {
all$Max.TempC <- (all$Max.TemperatureF - 32) * 5 / 9
all$Mean.TempC <- (all$Mean.TemperatureF - 32) * 5 / 9
all$Min.TempC <- (all$Min.TemperatureF - 32) * 5 / 9
#adjust precipitation becuase T is NA
#having trouble getting precipitation to work right now
#all$Precipmm <- as.numeric(as.numeric(all$PrecipitationIn) * 25.4)
}
return(all)
}
stationList <- list.files(path="country-raw/", pattern = ".csv", recursive=T)
#crop out the folder names
codes <- gsub(".*/", "", stationList)
codes <- substr(codes,1,4)
#create list of names to save as without the 2
saveNames <- gsub("2", "", stationList)
#create these directories so we can save in them
#sapply(paste("earlyYear/", unique(gsub("/.*", "", saveNames)), sep=""), dir.create)
newScrape <- function(codes, start, end){
for (c in 1:length(codes)){
all <- weatherScrape(codes[c], start=start, end=end)
fname <- paste("earlyYear/", saveNames[c], sep="")
write.csv(all, fname, row.names = F)
}
}
sapply(X=codes, newScrape, start="2012-10-01", end="2013-11-01")
head(saveNames)
saveNames[75]
?write.csv
codes[75]
length(codes)
newScrape <- function(codes, start, end){
for (c in 1:length(codes)){
all <- weatherScrape(codes[c], start=start, end=end)
fname <- paste("earlyYear/", saveNames[c], sep="")
write.csv(all, file=fname, row.names = F)
}
}
test <- codes[1:3]
newScrape(codes=test, start="2012-10-01", end="2013-11-01")
newScrape(codes=codes, start="2012-10-01", end="2013-11-01")
library(dplyr)
library(xtable)
august <- read.csv("../data/infections/infectionsAugust.csv")
#drop body and winglendgth for now
august <- select(august, -Head,-WingLength)
#dpi as factor
august$DPI <- as.factor(august$DPI)
#drop contaminated individuals
august <- filter(august, Body != "C")
august <- filter(august, Saliva != "C")
#add in class and site
august$site <- substr(as.character(august$Individual), 1, 2)
august$class <- NULL
for (i in 1:nrow(august)){
if (substr(august$site[i], 1,1)=="R"){
august$class[i] <- "Rural"
} else if (substr(august$site[i], 1,1)=="S"){
august$class[i] <- "Suburban"
} else if (substr(august$site[i], 1,1)=="U"){
august$class[i] <- "Urban"
}
}
august$class <- as.factor(august$class)
august$site <- as.factor(august$site)
#convert Y and N to 1 and 0 for statistics
levels(august$Body) <- c("NA", 0, 1)
august$Body <- as.numeric(as.character(august$Body))
levels(august$Saliva) <- c("NA", 0, 1)
august$Saliva <- as.numeric(as.character(august$Saliva))
setwd("~/Dropbox/UGA/Research/Murdock/urbanDengue/analysis")
august <- read.csv("../data/infections/infectionsAugust.csv")
#drop body and winglendgth for now
august <- select(august, -Head,-WingLength)
#dpi as factor
august$DPI <- as.factor(august$DPI)
#drop contaminated individuals
august <- filter(august, Body != "C")
august <- filter(august, Saliva != "C")
#add in class and site
august$site <- substr(as.character(august$Individual), 1, 2)
august$class <- NULL
for (i in 1:nrow(august)){
if (substr(august$site[i], 1,1)=="R"){
august$class[i] <- "Rural"
} else if (substr(august$site[i], 1,1)=="S"){
august$class[i] <- "Suburban"
} else if (substr(august$site[i], 1,1)=="U"){
august$class[i] <- "Urban"
}
}
august$class <- as.factor(august$class)
august$site <- as.factor(august$site)
#convert Y and N to 1 and 0 for statistics
levels(august$Body) <- c("NA", 0, 1)
august$Body <- as.numeric(as.character(august$Body))
levels(august$Saliva) <- c("NA", 0, 1)
august$Saliva <- as.numeric(as.character(august$Saliva))
augustSumm <- august %>%
#drop individual
select(-Individual) %>%
group_by(DPI, site, class) %>%
summarise_each(funs(mean,sd,se=(sd(.)/sqrt(n())))) %>%
ungroup()
augustSumm14 <- augustSumm[augustSumm$DPI=="14",]
barCenters <- barplot(augustSumm14$Body_mean,
col=c("gray80", "dodgerblue", "maroon")[augustSumm14$class],
names.arg=augustSumm14$site,
ylim=c(0,0.4),
main = "Body Infection (14 dpi)",
beside = T
)
barCenters <- barplot(augustSumm$Body_mean,
col=c("gray80", "dodgerblue", "maroon")[augustSumm$class],
names.arg=augustSumm$site,
ylim=c(0,0.4),
main = "Body Infection (14 dpi)",
beside = T
)
?gather
library(tidyr)
?gather
View(augustSumm)
matrix(augustSumm[,c(1,2,4)])
matrix(augustSumm[,c(1,2,4)], ncol = 9)
barCenters <- barplot(augustSumm21$Saliva_mean,
col=c("gray80", "dodgerblue", "maroon")[augustSumm21$class],
names.arg=augustSumm21$site,
ylim=c(0,0.5),
main = "Saliva Infection (21 dpi)"
)
#add se bars
segments(barCenters, augustSumm21$Saliva_mean - augustSumm21$Saliva_se , barCenters,
augustSumm21$Saliva_mean + augustSumm21$Saliva_se, lwd = 1.5)
augustSumm21 <- augustSumm[augustSumm$DPI=="21",]
barCenters <- barplot(augustSumm21$Body_mean,
col=c("gray80", "dodgerblue", "maroon")[augustSumm21$class],
names.arg=augustSumm21$site,
ylim=c(0,0.8),
main = "Body Infection (21 dpi)"
)
#add se bars
segments(barCenters, augustSumm21$Body_mean - augustSumm21$Body_se , barCenters,
augustSumm21$Body_mean + augustSumm21$Body_se, lwd = 1.5)
arrows(barCenters, augustSumm21$Body_mean - augustSumm21$Body_se , barCenters,
augustSumm21$Body_mean + augustSumm21$Body_se, lwd = 1.5,
angle = 90,
code = 3, length = 0.05)
barCenters <- barplot(augustSumm21$Saliva_mean,
col=c("gray80", "dodgerblue", "maroon")[augustSumm21$class],
names.arg=augustSumm21$site,
ylim=c(0,0.5),
main = "Saliva Infection (21 dpi)"
)
bodyBeside <- as.matrix(cbind(augustSumm$Saliva_mean[augustSumm$DPI=="14"], augustSumm$Saliva_mean[augustSumm$DPI=="21"]), ncol=2)
View(bodyBeside)
bodyBeside <- as.matrix(cbind(augustSumm$Body_mean[augustSumm$DPI=="14"], augustSumm$Body_mean[augustSumm$DPI=="21"]), ncol=2)
View(bodyBeside)
colnames(BodyBeside) <- c("14", "21")
colnames(bodyBeside) <- c("14", "21")
View(bodyBeside)
rownames(bodyBeside) <- levels(AugustSumm$site)
rownames(bodyBeside) <- levels(augustSumm$site)
View(bodyBeside)
barCenters <- barplot(bodyBeside, beside=T)
test <- t(bodyBeside)
barCenters <- barplot(test, beside=T)
bodyBeside <- t(bodyBeside)
bodyBeside <- as.matrix(cbind(augustSumm$Body_mean[augustSumm$DPI=="14"], augustSumm$Body_mean[augustSumm$DPI=="21"]), ncol=2)
colnames(bodyBeside) <- c("14dpi", "21dpi")
rownames(bodyBeside) <- levels(augustSumm$site)
bodyBeside <- t(bodyBeside)
barCenters <- barplot(bodyBeside,
beside=T,
col=c("gray80", "dodgerblue", "maroon"),
names.arg=colnames(bodyBeside),
ylim=c(0,0.6),
main = "Dengue Body Infections"
)
bodyBesideSE <- as.matrix(rbind(augustSumm$Body_se[augustSumm$DPI=="14"], augustSumm$Body_se[augustSumm$DPI=="21"]), nrow=2)
segments(barCenters, bodyBeside - bodyBesideSE , barCenters,
bodyBeside + bodyBesideSE, lwd = 1.5)
View(bodyBeside)
View(bodyBesideSE)
barCenters <- barplot(bodyBeside,
beside=T,
col=c(rep("gray80",6), rep("dodgerblue",6),
rep("maroon",6)),
names.arg=colnames(bodyBeside),
ylim=c(0,0.6),
main = "Dengue Body Infections"
)
bodyBesideSE <- as.matrix(rbind(augustSumm$Body_se[augustSumm$DPI=="14"], augustSumm$Body_se[augustSumm$DPI=="21"]), nrow=2)
segments(barCenters, bodyBeside - bodyBesideSE , barCenters,
bodyBeside + bodyBesideSE, lwd = 1.5)
View(bodyBeside)
barCenters <- barplot(bodyBeside,
beside=T,
col=c(rep("gray80",6), rep("dodgerblue",6),
rep("maroon",6)),
names.arg=colnames(bodyBeside),
ylim=c(0,0.8),
main = "Dengue Body Infections"
)
bodyBesideSE <- as.matrix(rbind(augustSumm$Body_se[augustSumm$DPI=="14"], augustSumm$Body_se[augustSumm$DPI=="21"]), nrow=2)
#add se bars
segments(barCenters, bodyBeside - bodyBesideSE , barCenters,
bodyBeside + bodyBesideSE, lwd = 1.5)
barCenters <- barplot(bodyBeside,
beside=T,
col=c(rep("gray80",6), rep("dodgerblue",6),
rep("maroon",6)),
names.arg=colnames(bodyBeside),
ylim=c(0,0.75),
main = "Dengue Body Infections"
)
bodyBesideSE <- as.matrix(rbind(augustSumm$Body_se[augustSumm$DPI=="14"], augustSumm$Body_se[augustSumm$DPI=="21"]), nrow=2)
#add se bars
segments(barCenters, bodyBeside - bodyBesideSE , barCenters,
bodyBeside + bodyBesideSE, lwd = 1.5)
barCenters <- barplot(bodyBeside,
beside=T,
col=c(rep("gray80",6), rep("dodgerblue",6),
rep("maroon",6)),
densities = c(0,20),
names.arg=colnames(bodyBeside),
ylim=c(0,0.75),
main = "Dengue Body Infections"
)
barCenters <- barplot(bodyBeside,
beside=T,
col=c(rep("gray80",6), rep("dodgerblue",6),
rep("maroon",6)),
density = c(0,20),
names.arg=colnames(bodyBeside),
ylim=c(0,0.75),
main = "Dengue Body Infections"
)
barCenters <- barplot(bodyBeside,
beside=T,
col=c(rep("gray80",6), rep("dodgerblue",6),
rep("maroon",6)),
density = c(100,20),
names.arg=colnames(bodyBeside),
ylim=c(0,0.75),
main = "Dengue Body Infections"
)
barCenters <- barplot(bodyBeside,
beside=T,
col=c(rep("gray80",6), rep("dodgerblue",6),
rep("maroon",6)),
density = c(20,100),
names.arg=colnames(bodyBeside),
ylim=c(0,0.75),
main = "Dengue Body Infections"
)
bodyBesideSE <- as.matrix(rbind(augustSumm$Body_se[augustSumm$DPI=="14"], augustSumm$Body_se[augustSumm$DPI=="21"]), nrow=2)
segments(barCenters, bodyBeside - bodyBesideSE , barCenters,
bodyBeside + bodyBesideSE, lwd = 1.5)
arrows(barCenters, bodyBeside - bodyBesideSE , barCenters,
bodyBeside + bodyBesideSE,
lwd = 1.5,
angle = 90,
code = 3, length = 0.05)
bodyBeside <- as.matrix(cbind(augustSumm$Body_mean[augustSumm$DPI=="14"], augustSumm$Body_mean[augustSumm$DPI=="21"]), ncol=2)
colnames(bodyBeside) <- c("14dpi", "21dpi")
rownames(bodyBeside) <- levels(augustSumm$site)
bodyBeside <- t(bodyBeside)
barCenters <- barplot(bodyBeside,
beside=T,
col=c(rep("gray80",6), rep("dodgerblue",6),
rep("maroon",6)),
density = c(20,100),
names.arg=colnames(bodyBeside),
ylim=c(0,0.75),
main = "Dengue Body Infections"
)
bodyBesideSE <- as.matrix(rbind(augustSumm$Body_se[augustSumm$DPI=="14"], augustSumm$Body_se[augustSumm$DPI=="21"]), nrow=2)
#add se bars
segments(barCenters, bodyBeside - bodyBesideSE , barCenters,
bodyBeside + bodyBesideSE, lwd = 1.5)
arrows(barCenters, bodyBeside - bodyBesideSE , barCenters,
bodyBeside + bodyBesideSE,
lwd = 1.5,
angle = 90,
code = 3, length = 0.03)
barCenters <- barplot(bodyBeside,
beside=T,
col=c(rep("gray80",6), rep("dodgerblue",6),
rep("maroon",6)),
density = c(20,100),
names.arg=colnames(bodyBeside),
ylim=c(0,0.80),
main = "Dengue Body Infections",
ylab = "Percent Positive for Dengue"
)
bodyBesideSE <- as.matrix(rbind(augustSumm$Body_se[augustSumm$DPI=="14"], augustSumm$Body_se[augustSumm$DPI=="21"]), nrow=2)
#add se bars
segments(barCenters, bodyBeside - bodyBesideSE , barCenters,
bodyBeside + bodyBesideSE, lwd = 1.5)
arrows(barCenters, bodyBeside - bodyBesideSE , barCenters,
bodyBeside + bodyBesideSE,
lwd = 1.5,
angle = 90,
code = 3, length = 0.03)
legend("topright", legend=c("14 dpi", "21 dpi"), density = c(20,100))
legend("topright", legend=c("14 dpi", "21 dpi"), density = c(20,100),
bty = "n", col = "gray80")
barCenters <- barplot(bodyBeside,
beside=T,
col=c(rep("gray80",6), rep("dodgerblue",6),
rep("maroon",6)),
density = c(20,100),
names.arg=colnames(bodyBeside),
ylim=c(0,0.80),
main = "Dengue Body Infections",
ylab = "Percent Infected",
border = c(rep("gray80",6), rep("dodgerblue",6),
rep("maroon",6))
)
barCenters <- barplot(bodyBeside,
beside=T,
col=c(rep("gray80",6), rep("dodgerblue",6),
rep("maroon",6)),
density = c(20,NA),
names.arg=colnames(bodyBeside),
ylim=c(0,0.80),
main = "Dengue Body Infections",
ylab = "Percent Infected",
border = c(rep("gray80",6), rep("dodgerblue",6),
rep("maroon",6))
)
barCenters <- barplot(bodyBeside,
beside=T,
col=c(rep("gray80",6), rep("dodgerblue",6),
rep("maroon",6)),
density = c(40,NA),
names.arg=colnames(bodyBeside),
ylim=c(0,0.80),
main = "Dengue Body Infections",
ylab = "Percent Infected",
border = c(rep("gray80",6), rep("dodgerblue",6),
rep("maroon",6))
)
barCenters <- barplot(bodyBeside,
beside=T,
col=c(rep("gray80",6), rep("dodgerblue",6),
rep("maroon",6)),
density = c(40,NA),
names.arg=colnames(bodyBeside),
ylim=c(0,0.80),
main = "Dengue Body Infections",
ylab = "Percent Infected"
#border = c(rep("gray80",6), rep("dodgerblue",6),
#rep("maroon",6))
)
segments(barCenters, bodyBeside - bodyBesideSE , barCenters,
bodyBeside + bodyBesideSE, lwd = 1.5,
col=c(rep("gray80",6), rep("dodgerblue",6),
rep("maroon",6)))
segments(barCenters, bodyBeside - bodyBesideSE , barCenters,
bodyBeside + bodyBesideSE, lwd = 1.5)
arrows(barCenters, bodyBeside - bodyBesideSE , barCenters,
bodyBeside + bodyBesideSE,
lwd = 1.5,
angle = 90,
code = 3, length = 0.03)
legend("topright", legend=c("14 dpi", "21 dpi"), density = c(40,NA),
bty = "n", col = "gray80")
SalivaBeside <- as.matrix(rbind(augustSumm$Saliva_mean[augustSumm$DPI=="14"], augustSumm$Saliva_mean[augustSumm$DPI=="21"]), nrow=2)
colnames(SalivaBeside) <- c("14dpi", "21dpi")
rownames(SalivaBeside) <- levels(augustSumm$site)
rownames(SalivaBeside) <- c("14dpi", "21dpi")
colnamesnames(SalivaBeside) <- levels(augustSumm$site)
colnames(SalivaBeside) <- levels(augustSumm$site)
barCenters <- barplot(SalivaBeside,
beside=T,
col=c(rep("gray80",6), rep("dodgerblue",6),
rep("maroon",6)),
density = c(40,NA),
names.arg=colnames(SalivaBeside),
ylim=c(0,0.80),
main = "Dengue Saliva Infections",
ylab = "Percent Infected",
border = c(rep("gray80",6), rep("dodgerblue",6),
rep("maroon",6))
)
barCenters <- barplot(SalivaBeside,
beside=T,
col=c(rep("gray80",6), rep("dodgerblue",6),
rep("maroon",6)),
density = c(40,NA),
names.arg=colnames(SalivaBeside),
ylim=c(0,0.50),
main = "Dengue Saliva Infections",
ylab = "Percent Infected",
border = c(rep("gray80",6), rep("dodgerblue",6),
rep("maroon",6))
)
SalivaBesideSE <- as.matrix(rbind(augustSumm$Saliva_se[augustSumm$DPI=="14"], augustSumm$Saliva_se[augustSumm$DPI=="21"]), nrow=2)
#add se bars
segments(barCenters, SalivaBeside - SalivaBesideSE , barCenters,
SalivaBeside + SalivaBesideSE, lwd = 1.5)
arrows(barCenters, SalivaBeside - SalivaBesideSE , barCenters,
SalivaBeside + SalivaBesideSE,
lwd = 1.5,
angle = 90,
code = 3, length = 0.03)
barCenters <- barplot(SalivaBeside,
beside=T,
col=c(rep("gray80",6), rep("dodgerblue",6),
rep("maroon",6)),
density = c(40,NA),
names.arg=colnames(SalivaBeside),
ylim=c(0,0.50),
main = "Dengue Saliva Infections",
ylab = "Percent Infected"
)
SalivaBesideSE <- as.matrix(rbind(augustSumm$Saliva_se[augustSumm$DPI=="14"], augustSumm$Saliva_se[augustSumm$DPI=="21"]), nrow=2)
#add se bars
segments(barCenters, SalivaBeside - SalivaBesideSE , barCenters,
SalivaBeside + SalivaBesideSE, lwd = 1.5)
arrows(barCenters, SalivaBeside - SalivaBesideSE , barCenters,
SalivaBeside + SalivaBesideSE,
lwd = 1.5,
angle = 90,
code = 3, length = 0.03)
legend("topright", legend=c("14 dpi", "21 dpi"), density = c(40,NA),
bty = "n", col = "gray80")
