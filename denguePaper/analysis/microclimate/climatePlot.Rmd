---
title: "climateAugust"
author: "Michelle Evans"
date: "10/6/2016"
output: html_document
---

```{r packages, message=F}
library(dplyr)
library(lme4)
library(lmerTest)
```

This document plots climate data from the both trials of the Athens Field Project in 2016.


```{r load and format data}
climate <- read.csv('../../data/microclimate/clean/2016TrialsAdult.csv')[,-1]
#toss out ridiculous levels
climate <- climate[climate$Temp<60,]
#format date
climate$Date <- strptime(climate$Date, format="%Y-%m-%d %H:%M:%S")
#draw out day
climate$Day <- as.Date(climate$Date)
```

```{r group by class and date}
#first take the daily mean, min and max for each tray
climatePot <- climate %>%
  select(-Date) %>%
  group_by(Day,Pot_ID, Class, Site_ID) %>%
  summarise_each(funs(max,min,mean)) %>%
  ungroup()

#then take the mean of this, keeping an overall weird max from sticking out and getting the average max temperature, rather than overall maximum
climateDay <- climatePot %>%
  select(-Pot_ID, -Site_ID) %>%
  group_by(Day, Class) %>%
  summarise_each(funs(mean)) %>%
  ungroup()

```

```{r plot, eval=F}
pdf("figures/Tempseries.pdf", width=10, height=6, family="sans")
par(mar=rep(6,4))
#create blank plot
with(climateDay[climateDay$Class=="Rural",],
     plot(x=Day, y=Temp_mean, pch=NA, ylim=c(0,38),
          xlab="Date", ylab="Temperature (C)", main = "Average Temperatures",
          cex.lab=2, cex.axis=2, las=1)
     )

#plot rural
with(climateDay[climateDay$Class=="Rural",],
     lines(x=Day, y=Temp_mean, col="dodgerblue", lty=1, lwd=2)) #mean
with(climateDay[climateDay$Class=="Rural",],
     lines(x=Day, y=Temp_max, col="dodgerblue", lty=3, lwd=2)) #max
with(climateDay[climateDay$Class=="Rural",],
     lines(x=Day, y=Temp_min, col="dodgerblue", lty=3, lwd=2)) #min

#plot Suburban
with(climateDay[climateDay$Class=="Suburban",],
     lines(x=Day, y=Temp_mean, col="gray20", lty=1, lwd=2)) #mean
with(climateDay[climateDay$Class=="Suburban",],
     lines(x=Day, y=Temp_max, col="gray20", lty=3, lwd=2)) #max
with(climateDay[climateDay$Class=="Suburban",],
     lines(x=Day, y=Temp_min, col="gray20", lty=3, lwd=2)) #min

#plot Urban
with(climateDay[climateDay$Class=="Urban",],
     lines(x=Day, y=Temp_mean, col="maroon", lty=1, lwd=2)) #mean
with(climateDay[climateDay$Class=="Urban",],
     lines(x=Day, y=Temp_max, col="maroon", lty=3, lwd=2)) #max
with(climateDay[climateDay$Class=="Urban",],
     lines(x=Day, y=Temp_min, col="maroon", lty=3, lwd=2)) #min
dev.off()
```

For stats we are going to look at the mean min and max daily temperatures for each class with Pot and Day as a random factor.

```{r stats for the climate data}
#subset for replicates
climateAug <- climate %>%
  select(-Date)%>%
  filter(Day <= "2016-09-03") %>%
  mutate(block="summer")

climateOct <- climate %>%
  select(-Date) %>%
  filter(Day >= "2016-09-26" & Day <= "2016-11-08") %>%
  mutate(block="fall")

climateRep <- rbind(climateAug, climateOct)
climateRep$block <- as.factor(climateRep$block)


#summary stats
tempSummary <- climateRep %>%
  select(-RH, -Pot_ID, -Site_ID) %>%
  group_by(block, Class, Day) %>%
  summarise_each(funs(mean, min, max)) %>%
  ungroup()%>%
  select(-Day)%>%
  group_by(block, Class) %>%
  summarise_each(funs(mean))
```

```{r stats}
climatePot <- climateRep %>%
  group_by(Day,Pot_ID, Class, Site_ID, block) %>%
  summarise_each(funs(max,min,mean)) %>%
  ungroup()

#then take the mean of this, keeping an overall weird max from sticking out and getting the average max temperature, rather than overall maximum
climatePotStat <- climatePot %>%
  group_by(Class, block, Pot_ID, Site_ID) %>%
  summarise_each(funs(mean)) %>%
  ungroup()



climateDay2 <- climateRep %>%
  select(-RH, -Site_ID) %>%
  group_by(block, Class, Pot_ID) %>%
  summarise_each(funs(mean,min,max)) %>%
  ungroup() 

#calculate degree days above 25C
degDay <- climateDay2 %>%
  filter(mean>25)%>%
  group_by(block, Pot_ID) %>%
  summarise(degDay = n()) %>%
  complete(Pot_ID, fill= list(degDay=0)) %>%
  ungroup()

#drop R3A2 becuase it is large outlier
climatePot <- climatePot[climatePot$Pot_ID!="R3A2",]

modelMean <- lmerTest::lmer(Temp_max~Class + block + Class*block + (1|Site_ID),
                            data=climatePotStat)
summary(modelMean)

modelMin <- lmerTest::lmer(Temp_min~Class + (1|Site_ID) + (1|Day),
                            data=climatePot)
summary(modelMin)

modelMax <- lmerTest::lmer(Temp_max~Class + (1|Site_ID) + (1|Day),
                            data=climatePot)
summary(modelMax)
```

For the mean and minimum temperature, urban and rural are significantly different from other land classes and suburban kind of falls between it all. For maximum temperature, only rural is significantly different.