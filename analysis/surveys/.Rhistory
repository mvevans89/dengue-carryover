library(parallel)
detectCores()
---
title: "Larval Habitat Surveys: Exploratory Analysis"
author: "Michelle Evans"
date: "December 13, 2016"
output: html_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(FactoMineR)
library(lubridate)
library(factoextra)
library(caret)
library(ggplot2)
library(PerformanceAnalytics)
```
# Purpose
This document is for the exploratory analysis of larval survey data from the Summer of 2016 in Athens, GA.
It has two datasets collected from the field:
- `identifications.csv`: This is the identification of adult mosquitoes that emerged from larvae that was brought back to the lab.
- `larvalHabitat.csv`: This is the quantitative and qualitative data about the larval habitats.
The datasets are connected by their site, Grid No. and Date.
# Load and Format Data
## Cleaning Raw Data
This loads and formats the raw data, which will then be saved as cleaned data.
```{r habitat data, eval=F}
habitats <- read.csv("../../data/larvalSurveys/raw/larvalHabitat.csv")
#reformat date
habitats$Date <- as.Date(as.character(habitats$Date), format="%m/%d/%y")
#reformat time
habitats$Time <- as.character((habitats$Time))
#drop unnecessary columns (radius, type)
habitats <- select(habitats, -Radius, -Type, -Notes)
#change Oth. Invert to Binary
levels(habitats$Oth.Invert)[levels(habitats$Oth.Invert) %in% c("Noe", "None", "ants")] <- 0
levels(habitats$Oth.Invert)[levels(habitats$Oth.Invert) != 0] <- 1
levels(habitats$Larvae.Pupae)[levels(habitats$Larvae.Pupae)=="Eggs"] <- "None"
write.csv(habitats, "../../data/larvalSurveys/clean/larvalHabitat.csv", row.names = F)
```
```{r identification data, eval=F}
ids <- read.csv("../../data/larvalSurveys/raw/identifications.csv")
#format data
ids$Date <- as.Date(as.character(ids$Date.collected), format="%m/%d/%y")
#change site to code
ids$Site <- ids$Code
#fix errors in species names
ids$Species[ids$Species=="Aedes albopictus "] <- "Aedes albopictus"
ids$Species[ids$Species=="Aedes triseriatus "] <- "Aedes triseriatus"
ids$Species[ids$Species=="Anopheles punctipennis "] <- "Anopheles punctipennis"
ids$Species[ids$Species=="Culex quinquefaciatus"] <- "Culex quinquefasciatus"
idsClean <- select(ids, Site, Date, Grid=Location..grid., Species, Sex, No.)
#expand data so each mosquito is individual
idsCleanX<- idsClean[rep(seq.int(1,nrow(idsClean)), idsClean$No.),]
idsClean <-  select(idsCleanX, - No.)
write.csv(idsClean, "../../data/larvalSurveys/clean/Identifications.csv", row.names = F)
```
## Loading Clean Data
```{r load cleaned data, eval=T}
habitats <- read.csv("../../data/larvalSurveys/clean/larvalHabitat.csv", stringsAsFactors = F)
habitats$Date <- as.Date((habitats$Date))
habitats$Positive <- ifelse(habitats$Larvae.Pupae=="None",0,1)
habitats <- habitats %>%
mutate(class = case_when(
.$Site %in% c("R1", "R2", "R3") ~ "rural",
.$Site %in% c("S1", "S2", "S3") ~ "suburban",
.$Site %in% c("U1", "U2", "U3") ~ "urban"
))
ids <- read.csv("../../data/larvalSurveys/clean/Identifications.csv", stringsAsFactors = F)
ids$Date <- as.Date(ids$Date)
```
## Join Habitat data with Larval Positivity and Identification
After joining, I realized that some larval identifications were not fully labeled (n=134). That is, there may be two habitats in a grid, 27A and 27B, but the larvae are only labeled 27. For several of these, it is possible to "fix" because only one of the habitats was positive for larvae, so we can safely assume the larvae came from there. Another issue is that sometimes the date was misrecorded, these are pretty easy to match with a correct date, however.
I attempted to this all reproducibly in this document, but, as many are simple typing errors it would have involved typing code to manually correct each line, so I corrected the cleaned dataset. Any corrections that were not completely objective are recorded below so that I could then go back to original datasheets to fill in.
- S1 > 2016-07-19 >Grid 48 has recorded Ae. Albopictus, but isn't on larval habitat sheet
- S1 > 2016-08-02 > Grid 55 was recorded as Ae. albpictus, but there are 55A,B, and C.  Only B and C were positive for larvae.
- S1 > 2016-08-15 Grid 55 doesn't exist in larval habitat data
- S2 > 2016-07-05 Grid 25 doesn't exist in larval habitat data
- S2 > 2016-07-21 Grid 59A doesn't exist in larval habitat data
- all larval habitat for U2 08-02 hasn't been updated
- S2 > 2016-09-12 id has no Grid, could be 19 or 47
- S3 > 08-17 is grid 49, don't know which one, 48 is listed as an id but no on larval habitat data
- U1 > 08-17 grid 49 on id, don't know which one
- U2 > 08-17 49b listed on id but not on larval habitat
- U2 2016-08-17 11:45 37 is wrong I think, either the container or the pond
```{r join datasets}
both <- full_join(habitats, ids, by=c("Date", "Site", "Grid"))
missing <- both %>%
filter(!is.na(Species)) %>%
filter(is.na(Positive))
```
```{r positive habitat only}
positive <- unique(inner_join(habitats, ids, by=c("Date", "Site", "Grid")))
positive$week <- week(positive$Date)
#double check it is positive only
positive <- filter(positive, positive$Positive==1)
weeklyPos <- positive %>%
group_by(week, Site, class) %>%
summarise(noHab=n())
plot(x=jitter(weeklyPos$week), y=weeklyPos$noHab, col=c("dodgerblue", "gray80", "maroon")[as.factor(weeklyPos$class)], pch=20)
lines(x=weeklyPos$week, y=weeklyPos$noHab, col=c("dodgerblue", "gray80", "maroon")[as.factor(weeklyPos$class)])
points(x=weeklyPos$week, y=weeklyPos$noHab, col=c("dodgerblue", "gray80", "maroon")[weeklyPos$class], pch=20)
```
# Summary Stats and Basic Viz of Habitat Data
```{r table of summary stats by site}
habitatSumm <- habitats %>%
group_by(Site) %>%
select(-Date, -Time, -Grid, -Larvae.Pupae, -Oth.Invert, -Type..factor.) %>%
summarise_each(funs(mean(., na.rm=T), min(., na.rm=T), max(., na.rm=T))) %>%
ungroup()
print(habitatSumm)
```
```{r plot habitat by site over time}
temporalHabitat <- habitats %>%
group_by(Site,Date, Positive) %>%
summarise(habQuantity=n()) %>%
ungroup()
#quick facet plot
ggplot(temporalHabitat, aes(x=Date, y=habQuantity)) +
geom_point() +
geom_line() +
facet_grid(Positive ~ Site)
```
# PCA of positive vs. non-positive
```{r habitat pca}
pcaDat <- habitats %>%
filter(Site != "U3" & Type..factor.!="pond") %>% #drops big pond at U3 (outlier)
select(Positive, type=Type..factor., date=Date, class, area=Surface.Area..cm2., depth=Depth..cm., canCover=Canopy.Cover, turb=Turbidity, temp=Temp)
#drop large pond at U3 (severe outlier)
#check out data
for (col in 5:ncol(pcaDat)) {
hist(pcaDat[,col])
}
#trasnform and scale data
pcaDat <- na.omit(pcaDat) #omit NAs
pcaScale <- scale(pcaDat[,5:ncol(pcaDat)], center=T, scale=T) #center and scale
#summary stats
cor(pcaScale)
summary(pcaDat)
library(PerformanceAnalytics)
chart.Correlation(pcaScale, histogram=T)
#PCA
habPCA <- PCA(pcaScale, scale.unit = T, graph=T)
fviz_screeplot(habPCA, ncp=10)
#looking at larval positivity
fviz_pca_ind(habPCA, label="none", habillage=pcaDat$Positive, addEllipses=T, ellipse.level=0.90)
#habitat type
fviz_pca_ind(habPCA, label="none", habillage=pcaDat$type, addEllipses=T, ellipse.level=0.95)
#date
fviz_pca_ind(habPCA, label="none", habillage=as.factor(month(pcaDat$date)), addEllipses=T, ellipse.level=0.95)
#class
fviz_pca_ind(habPCA, label="none", habillage=pcaDat$class, addEllipses=T, ellipse.level=0.95)
#3D
library(rgl)
plot3d(habPCA$ind$coord, col=as.numeric(as.factor((pcaDat$class)))) #need x11 installed
plot3d(habPCA$ind$coord, col=as.numeric(pcaDat$type))
#looking at it in 3D tells me that there is one outlier that should be dropped (large pond at U3)
#dim.3 has some cool shit going on
plot(x=habPCA$ind$coord[,2], y=habPCA$ind$coord[,3], pch=20, col=as.numeric(as.factor((pcaDat$class))))
```
## Important Points
- Rural seems to be significantly different from urban and suburban
- looking at dim 1, 2 ,3 is important
## Questions
- how do I statistically look at PCA's?
habitats <- read.csv("../../data/larvalSurveys/clean/larvalHabitat.csv", stringsAsFactors = F)
habitats$Date <- as.Date((habitats$Date))
habitats$Positive <- ifelse(habitats$Larvae.Pupae=="None",0,1)
habitats <- habitats %>%
mutate(class = case_when(
.$Site %in% c("R1", "R2", "R3") ~ "rural",
.$Site %in% c("S1", "S2", "S3") ~ "suburban",
.$Site %in% c("U1", "U2", "U3") ~ "urban"
))
ids <- read.csv("../../data/larvalSurveys/clean/Identifications.csv", stringsAsFactors = F)
ids$Date <- as.Date(ids$Date)
setwd("~/Dropbox/UGA/Research/Murdock/urbanDengue/analysis/surveys")
habitats <- read.csv("../../data/larvalSurveys/clean/larvalHabitat.csv", stringsAsFactors = F)
habitats$Date <- as.Date((habitats$Date))
habitats$Positive <- ifelse(habitats$Larvae.Pupae=="None",0,1)
habitats <- habitats %>%
mutate(class = case_when(
.$Site %in% c("R1", "R2", "R3") ~ "rural",
.$Site %in% c("S1", "S2", "S3") ~ "suburban",
.$Site %in% c("U1", "U2", "U3") ~ "urban"
))
ids <- read.csv("../../data/larvalSurveys/clean/Identifications.csv", stringsAsFactors = F)
ids$Date <- as.Date(ids$Date)
positive <- unique(inner_join(habitats, ids, by=c("Date", "Site", "Grid")))
positive$week <- week(positive$Date)
positive <- filter(positive, positive$Positive==1)
weeklyPos <- positive %>%
group_by(week, Site, class) %>%
summarise(noHab=n())
plot(x=jitter(weeklyPos$week), y=weeklyPos$noHab, col=c("dodgerblue", "gray80", "maroon")[as.factor(weeklyPos$class)], pch=20)
lines(x=weeklyPos$week, y=weeklyPos$noHab, col=c("dodgerblue", "gray80", "maroon")[as.factor(weeklyPos$class)])
points(x=weeklyPos$week, y=weeklyPos$noHab, col=c("dodgerblue", "gray80", "maroon")[weeklyPos$class], pch=20)
summary(positive)
library(purr)
install.packages("purr")
library("tibbles")
install.packages("tibbles")
library("tidyverse")
install.packages("tidyverse")
library(tidyverse)
positive <- as.tibble(filter(positive, positive$Positive==1))
?tibble
positive <- tibble(filter(positive, positive$Positive==1))
postib <- tibble(positive)
classSummary <- positive %>%
group_by(class) %>%
summarise_each(mean, n(), min, max)
classSummary <- positive %>%
group_by(class) %>%
summarise_each(funs(mean, n(), min, max))
warnings
View(classSummary)
summary(positive)
containerSummary <- positive %>%
group_by(Type..factor.) %>%
summarise_each(funs(mean, n(), min, max))
View(containerSummary)
library(PerformanceAnalytics)
install.packages("PerformanceAnalytics")
library(PerformanceAnalytics)
chart.Correlation(positive, histogram=T)
?chart.Correlation
ggcorplot(
data=positive[,c(5:11)]
)
library(ggplot2)
ggcorplot(
data=positive[,c(5:11)]
)
plotmatrix(
data=positive[,c(5:11)]
)
pairs(positive[,c(5:11)])
pairs(positive[c(5:11)])
library(caret)
colnames(positive)
featurePlot(x= positive[c(5:11)], y=positive[,14], plot="pairs")
data(iris)
head(iris)
positive$class <- as.factor(positive$class)
positive$Type..factor. <- as.factor(positive$Type..factor.)
positive$Larvae.Pupae <- as.factor(positive$Larvae.Pupae)
featurePlot(x= positive[,c(5:11)], y=positive[,14], plot="pairs")
featurePlot(x= positive[,c(5:11)], y=positive[,14], plot="pairs", auto.key=list(columns=3))
featurePlot(x= positive[,c(5,6,7,9,10)], y=positive[,14], plot="pairs", auto.key=list(columns=3))
featurePlot(x= positive[,c(5,6,7,9,10)], y=positive[,14], plot="density", auto.key=list(columns=3))
featurePlot(x= positive[,c(5,6,7,9,10)], y=positive[,14], plot="density", auto.key=list(columns=3), scales=list(x=list(relation="free"), y=list(relation="free")))
positive$Species <- as.factor(positive$Species)
colnames(positive)
featurePlot(x= positive[,c(5,6,7,9,10, 15)], y=positive[,14], plot="density", auto.key=list(columns=3), scales=list(x=list(relation="free"), y=list(relation="free")))
levels(positive$Species)
View(positive)
test <- positive %>%
group_by(Site, Grid, Date) %>%
transmute(spRich=n_distinct(Species))
View(test)
positive <- positive %>%
group_by(Site, Grid, Date) %>%
mutate(spRich=n_distinct(Species)) %>%
ungroup()
View(positive)
featurePlot(x= positive[,c(5,6,7,9,10, 18)], y=positive[,14], plot="pairs", auto.key=list(columns=3))
head(positive[,14])
featurePlot(x= positive[,c(5,6,7,9,10,18)], y=positive[,14], plot="pairs", auto.key=list(columns=3))
featurePlot(x= positive[,c(5,6,7,9,10)], y=positive[,14], plot="pairs", auto.key=list(columns=3))
featurePlot(x= positive[,c(5,6,7,9,10,18)], y=positive[,14], plot="density", auto.key=list(columns=3), scales=list(x=list(relation="free"), y=list(relation="free")))
featurePlot(x= positive[,c(5,6,7,9,10,18)], y=positive[,14], plot="density", auto.key=list(columns=3), scales=list(x=list(relation="free"), y=list(relation="free")))
str(positive)
31400/100
positive <- unique(inner_join(habitats, ids, by=c("Date", "Site", "Grid")))
positive$week <- week(positive$Date)
#double check it is positive only
positive <- filter(positive, positive$Positive==1)
#add factor formatting
positive$class <- as.factor(positive$class)
positive$Type..factor. <- as.factor(positive$Type..factor.)
positive$Larvae.Pupae <- as.factor(positive$Larvae.Pupae)
positive$Species <- as.factor(positive$Species)
featurePlot(x=positive[,c(5,6,7,9,10)], y=positive[,14], plot="pairs", auto.key=list(columns=3))
positive <- positive %>%
group_by(Site, Grid, Date) %>%
mutate(spRich=n_distinct(Species)) %>%
ungroup()
positive <- as.data.frame(positive)
featurePlot(x=positive[,c(5,6,7,9,10)], y=positive[,14], plot="pairs", auto.key=list(columns=3))
featurePlot(x=positive[,c(5,6,7,9,10,18)], y=positive[,14], plot="pairs", auto.key=list(columns=3))
featurePlot(x= positive[,c(5,6,7,9,10,18)], y=positive[,14], plot="density", auto.key=list(columns=3), scales=list(x=list(relation="free"), y=list(relation="free")))
classSummary <- positive %>%
group_by(class) %>%
mutate(spRich=n_distinct(Species)) %>%
summarise_each(funs(mean, n(), min, max))
View(classSummary)
classSummary <- positive %>%
group_by(class) %>%
mutate(spRichSite=n_distinct(Species)) %>%
summarise_each(funs(mean, n(), min, max))
warnings
View(classSummary)
siteSpRich <- positive %>%
group_by(Site, Date) %>%
summarise(spRich=n_distinct(Species)) %>%
ungroup()
View(siteSpRich)
siteSpRich <- positive %>%
group_by(Site) %>%
summarise(spRich=n_distinct(Species)) %>%
ungroup()
View(siteSpRich)
spSeason <- positive %>%
group_by(Date, Species) %>%
summarise(posHab=n()) %>%
ungroup()
View(spSeason)
ggplot(spSeason, aes(x=Date, y=posHab, group=Species)) +
geom_line(aes(colour=Species))
featurePlot(x=positive[,c(5,6,7,9,10,18)], y=positive[,14], plot="pairs", auto.key=list(columns=3))
hist(positive$Surface.Area..cm2.)
hist(log(positive$Surface.Area..cm2.))
hist(positive$Depth..cm.)
hist(log(positive$Depth..cm.))
hist(positive$Temp)
hist(positive$Canopy.Cover)
hist(log(positive$Canopy.Cover))
library(MASS)
?boxcos
?boxcox
boxcox(Volume ~ log(Height) + log(Girth), data = trees,
lambda = seq(-0.25, 0.25, length = 10))
hist(sqrt(positive$Canopy.Cover))
hist((positive$Canopy.Cover))
hist(log(positive$Canopy.Cover))
hist(log(101 - positive$Canopy.Cover))
hist((101 - positive$Canopy.Cover))
hist(sqrt(101 - positive$Canopy.Cover))
summary(positive$Canopy.Cover)
hist(log(101 - positive$Canopy.Cover))
colnames(positive)
positive$surfAreaLog <- log(positive$Surface.Area..cm2.)
positive$depthLog <- log(positive$Depth..cm.)
featurePlot(x=positive[,c(5,6,7,9,10,18, 19, 20)], y=positive[,14], plot="pairs", auto.key=list(columns=3))
featurePlot(x=positive[,c(7,9,10,18, 19, 20)], y=positive[,14], plot="pairs", auto.key=list(columns=3))
featurePlot(x= positive[,c(7,9,10,18,19,20)], y=positive[,14], plot="density", auto.key=list(columns=3), scales=list(x=list(relation="free"), y=list(relation="free")))
plot(positive$class, positive$surfAreaLog)
plot(positive$temp, positive$surfAreaLog)
plot(positive$temp, positive$surfAreaLog)
View(positive)
plot(positive$class, positive$Temp)
ggplot(spSeason, aes(x=Date, y=posHab, group=Species)) +
geom_line(aes(colour=Species))
featurePlot(x=positive[,c(7,9,10,18, 19, 20)], y=positive[,14], plot="pairs", auto.key=list(columns=3))
featurePlot(x= positive[,c(7,9,10,18,19,20)], y=positive[,14], plot="density", auto.key=list(columns=3), scales=list(x=list(relation="free"), y=list(relation="free")))
plot(positive$class, positive$Temp)
View(positive)
plot(positive$Species, positive$spRich)
plot(positive$Species, positive$spRich, las=2)
points(positive$Species, positive$spRich, las=2, pch=20, col=c("dodgerblue", "gray80", "maroon")[positive$class])
points(jitter(positive$Species), positive$spRich, las=2, pch=20, col=c("dodgerblue", "gray80", "maroon")[positive$class])
points(jitter(as.numeric((positive$Species)), positive$spRich, las=2, pch=20, col=c("dodgerblue", "gray80", "maroon")[positive$class])
)
plot(positive$Species, positive$spRich, las=2)
points(jitter(as.numeric((positive$Species))), positive$spRich, las=2, pch=20, col=c("dodgerblue", "gray80", "maroon")[positive$class])
